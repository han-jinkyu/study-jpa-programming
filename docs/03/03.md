# 3. 엔티티의 생명주기

엔티티에는 4가지 상태가 존재한다.

- 비영속(new/transient): 영속성 컨텍스트와 전혀 **관계가 없는** 상태
- 영속(managed): 영속성 컨텍스트에 **저장**된 상태
- 준영속(detached): 영속성 컨텍스트에 저장되었다가 **분리**된 상태
- 삭제(removed): **삭제**된 상태

```
                      [ Detached ]
                          /| |
                           | |
                  detach() | |
                   clear() | | merge()
                   close() | |
                           | |                     ____
          persist()        | |/     find(), JPQL  <____>
[ New ] -------------> [ Managed ] <------------- | DB |
                          /| |     -------------> <____>
                           | |          flush()
                 persist() | | remove()          
                           | |
                           | |/
                       [ Removed ]
``` 

### 비영속

- 엔티티 객체를 막 생성하여 순수한 객체이며 저장하지 않았다.
- 따라서 영속성 컨텍스트나 데이터베이스와는 전혀 관련이 없다.

### 영속

- 엔티티 매니저를 통해 엔티티를 영속성 컨텍스트에 저장했다.
- 영속성 컨텍스트가 엔티티를 관리하는 상태다.
- `em.find()`나 JPQL을 사용해서 조회한 엔티티도 영속성 컨텍스트가 관리하는 영속 상태다.

### 준영속

- 영속성 컨텍스트가 관리하던 엔티티를 관리하지 않게 되면 준영속 상태가 된다.
- `em.detach()`를 호출하면 준영속 상태로 바뀐다.
- `em.close()`나 `em.clear()`를 호출하면 관리하던 영속 상태의 엔티티가 준영속 상태가 된다.

### 삭제

- 엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제한다.

-----
[Home](./index.md)
