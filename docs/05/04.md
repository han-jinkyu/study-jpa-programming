# 4. 연관관계의 주인

- `@OneToMany.mappedBy` 속성은 왜 필요한가?
- 엄밀히 얘기하면 객체에는 양방향 연관관계라는 것은 없다.
- 반면 데이터베이스 테이블은 왜래키 하나로 양방향 연관관계를 맺는다.
- 객체 연관관계는 다음과 같다.
    - 회원 -> 팀 연관관계 1개(단방향)
    - 팀 -> 회원 연관관계 1개(단방향)
- 테이블 연관관계는 다음과 같다.
    - 회원 <-> 팀의 연관관계 1개(양방향)
- 엔티티를 양방향 연관관계로 설정하면 객체의 참조는 둘인데 외래키는 하나다. 따라서 둘 사이에 차이가 발생한다.
- 이런 차이로 JPA에서는 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 한다.
- 이를 **연관관계의 주인**이라 한다.


## 4.1 양방향 매핑의 규칙: 연관관계의 주인

- 양방향 연관관계 매핑시 두 연관관계 중 하나를 연관관계의 주인(Owner)로 정해야 한다.
- **연관관계의 주인만이 데이터베이스 연관관계와 매핑되고 외래키를 관리**할 수 있다.
- 반면 **주인이 아닌 쪽은 읽기만** 할 수 있다.
- 어떤 연관관계를 주인으로 정할지는 `mappedBy` 속성을 사용하면 된다.
    - 주인은 `mappedBy` 속성을 사용하지 않는다.
    - 주인이 아니면 `mappedBy` 속성을 사용해서 속성의 값으로 연관관계의 주인을 지정해야 한다.
- 그렇다면 `Member.team`, `Team.members` 둘 중 어떤 것을 연관관계의 주인으로 정해야 할까?
- **연관관계의 주인을 정한다는 것은 사실 외래키 관리자를 선택하는 것**이다.
- 여기서 회원 테이블에 있는 `TEAM_ID` 외래키를 관리할 관리자를 선택해야 한다.
- 만약 회원 엔티티에 있는 `Member.team`을 주인으로 선택하면 자기 테이블에 있는 외래키를 관리하면 된다.
- 하지만 팀 엔티티에 있는 `Team.members`를 주인으로 선택하면 물리적으로 전혀 다른 테이블의 외래키를 관리해야 한다.


## 4.2 연관관계의 주인은 외래키가 있는 곳

- 연관관계의 주인은 테이블에 외래키가 있는 곳으로 정해야 한다.
- 여기서는 회원 테이블이 외래키를 가지고 있으므로 `Member.team`이 주인이 된다.
- 주인이 아닌 `Team.members`에는 `mappedBy="team"` 속성을 사용해서 주인이 아님을 설정한다.
- 여기서 `"team"`은 연관관계의 주인인 `Member` 엔티티의 `team` 필드를 말한다.
- 즉 연관관계의 주인만 데이터베이스 연관관계와 매핑되며 외래키를 관리할 수 있다.
- 주인이 아닌 반대편(inverse, non-owning side)은 읽기만 가능하고 외래키를 변경하지는 못한다.
- 참고로 데이터베이스 테이블의 다대일, 일대다 관계에서는 항상 '다'쪽이 외래키를 가진다.
- 따라서 '다'쪽인 `@ManyToOne`은 항상 연관관계의 주인이므로 `mappedBy`가 없다.

-----
[Home](./index.md)
